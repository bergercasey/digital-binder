<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HVAC Digital Binder</title>
  <style>
    :root {
      --bg: #fff;
      --ink: #111;
      --muted: #6b7280;
      --line: #e5e7eb;
      --accent: #2563eb;
      --accent-ink: #fff;
      --pad: 12px;
      --tab-ink: #111;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: var(--ink); background: var(--bg); }
    header { padding: 10px var(--pad); border-bottom: 1px solid var(--line); position: sticky; top: 0; background: var(--bg); z-index: 10; }
    h1 { margin: 0 0 6px; text-align: center; font-size: 20px; font-weight: 700; }
    .toolbar { display:flex; justify-content:center; gap:8px; flex-wrap:wrap; align-items:center; }
    button, select, input[type="text"], textarea, input[type="file"], input[type="color"] {
      font: inherit;
      padding: 6px 10px;
      border: 1px solid var(--line);
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
    }
    input[type="text"], textarea, select, input[type="color"] { cursor:text; }
    input[type="file"] { padding: 6px; }
    button.primary { background: var(--accent); color: var(--accent-ink); border-color: var(--accent); cursor:pointer; }
    button.danger { background: #ef4444; color: #fff; border-color: #ef4444; cursor:pointer; }
    button.ghost { background: transparent; border-color: var(--line); cursor:pointer; }
    .status { text-align:center; font-size:12px; color: var(--muted); margin-top: 6px; }
    main { display: grid; grid-template-columns: 240px 1fr; min-height: calc(100vh - 100px); }
    aside { border-right: 1px solid var(--line); padding: var(--pad); }
    .aside-head { display:flex; justify-content:space-between; align-items:center; margin-bottom: 8px; }
    .list { display:flex; flex-direction:column; gap:6px; }
    /* Contractor card: compact */
    .contractor { display:flex; gap:6px; align-items:center; padding:4px 6px; border:1px solid var(--line); border-radius: 8px; cursor:pointer; }
    .contractor.active { outline: 2px solid var(--accent); }
    .contractor input[type="text"] { width: 100%; border:none; outline:none; font-size: 14px; padding: 4px 6px; }
    section.content { padding: var(--pad); }
    .top-row { display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between; margin-bottom: 10px; }
    /* Notebook Tabs */
    .tabs-wrap { width:100%; border-bottom: 2px solid var(--line); padding-bottom: 4px; min-height: 44px; }
    .tabs { display:flex; gap:4px; flex-wrap:wrap; align-items:flex-end; }
    .tab {
      position: relative;
      padding: 4px 8px;
      border:1px solid var(--line);
      border-bottom: none;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      cursor: pointer;
      transform: translateY(2px);
      min-width: 140px;
    }
    .tab.active { background: #fff !important; transform: translateY(0); z-index: 2; }
    .tab .label { display:flex; flex-direction:column; line-height:1.15; }
    .tab .line1 { font-weight: 700; font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .tab .line2 { font-weight: 500; font-size: 11px; color: #111; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .fields { display:grid; grid-template-columns: 1.5fr 0.8fr 1fr; gap:12px; align-items:end; }
    .field { display:flex; flex-direction:column; gap:6px; }
    .field.small input { width: 100%; }
    label { font-size: 12px; color: var(--muted); }
    textarea { min-height: 120px; resize: vertical; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .spacer { flex:1; }
    .archive-toggle { display:flex; align-items:center; gap:6px; }
    .muted { color: var(--muted); }
    .chips { display:flex; gap:6px; flex-wrap:wrap; }
    .chip { padding: 4px 8px; border:1px solid var(--line); border-radius:999px; font-size:12px; }
    .view { display:none; }
    .view.active { display:block; }
    /* Landing */
    .placeholder {
      display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:center;
      height: 60vh; color: var(--muted); border: 2px dashed var(--line); border-radius: 12px;
      background: #fafafa; padding:0;
    }
    .placeholder img { width: 100%; height: 100%; object-fit: cover; }
    /* Contractor "home" panel */
    .logo-panel { display:flex; align-items:center; justify-content:center; height: 320px; border: 2px dashed var(--line); border-radius: 12px; background:#fafafa; margin-top:12px; }
    .logo-panel img { max-height: 280px; max-width: 90%; object-fit: contain; }
    .logo-controls { display:flex; gap:8px; align-items:center; margin-top: 10px; }
    /* Notes */
    .note-item { padding:10px; border:1px solid var(--line); border-radius:8px; background:#fff; }
    .note-date { font-size:12px; color:var(--muted); margin-bottom:4px; }
    /* Toasts */
    .toast-wrap { position: fixed; bottom: 18px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; flex-direction: column; z-index: 9999; pointer-events: none; }
    .toast { pointer-events: auto; padding: 10px 14px; border: 1px solid var(--line); border-radius: 10px; background: #fff; box-shadow: 0 6px 24px rgba(0,0,0,0.12); font-size: 14px; min-width: 200px; text-align: center; }
    /* Error banner */
    .errbar { position: fixed; top: 0; left: 0; right: 0; background: #fee2e2; color: #991b1b; padding: 8px 12px; font-size: 13px; border-bottom: 1px solid #fecaca; z-index: 10000; display: none; }
    @media (max-width: 1100px) { .fields { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 700px) { main { grid-template-columns: 1fr; } aside { border-right: none; border-bottom: 1px solid var(--line); } .fields { grid-template-columns: 1fr; } }
  
  .note-text { white-space: pre-wrap; }
  .note-toolbar button { padding: 4px 8px; font-size: 12px; cursor: pointer; }
  .note-toolbar button.active { background: var(--accent-50); border-color: var(--accent-200); }
  .note-editor { width: 100%; min-height: 160px; box-sizing: border-box; padding: 10px; border: 1px solid var(--line); border-radius: 8px; background: var(--panel); }
  .note-editor:focus { outline: 2px solid var(--accent-200); }
  .note-editor:empty:before { content: attr(data-placeholder); color: var(--muted); }

  /* Print-only sheet */
  @media print {
    html, body { margin: 0 !important; padding: 0 !important; }
    body * { display: none !important; }
    #print-sheet, #print-sheet * { display: block !important; visibility: visible !important; }
    #print-sheet { position: static; padding: 24px; display: block !important; }
    .print-head { margin-bottom: 16px; border-bottom: 1px solid #ddd; padding-bottom: 8px; }
    .print-title { font-size: 20px; font-weight: 600; }
    .print-meta { margin-top: 6px; font-size: 12px; color: #555; }
    .print-note { margin: 14px 0; page-break-inside: avoid; }
    .print-date { font-size: 12px; color: #666; margin-bottom: 4px; }
    .print-body { font-size: 14px; line-height: 1.4; }
  }
  /* Selection highlight for note card */
  .note-card.selected { outline: 2px solid var(--accent-200); }

  .note-item.selected{ outline: 2px solid var(--accent-200); }

  .note-item.selected{ outline: 3px solid var(--accent-300); border-radius: 8px; }
  .print-tip { font-size: 12px; color: var(--muted); margin: 4px 0 8px; }

  .note-item { position: relative; }
  .note-item.selected{ outline: 3px solid var(--accent-300) !important; border-radius: 8px; background: var(--accent-25); }
  .note-selected-chip { position: absolute; top: 6px; right: 6px; font-size: 11px; padding: 2px 6px; border-radius: 999px; background: var(--accent-50); border: 1px solid var(--accent-200); }

  .note-item.selected { outline: 3px solid var(--accent-300); border-radius: 8px; background: var(--accent-25); }

/* Top-right user display */
header { position: relative; }
.header-right { position: absolute; right: 12px; top: 8px; display: inline-flex; gap: 8px; align-items: center; }
    </style>
<link rel="apple-touch-icon" sizes="180x180" href="/jobs-icon-180.png?v=1758975222">
  <link rel="apple-touch-icon" sizes="167x167" href="/jobs-icon-167.png?v=1758975222">
  <link rel="apple-touch-icon" sizes="152x152" href="/jobs-icon-152.png?v=1758975222">
  <link rel="icon" type="image/png" sizes="32x32" href="/jobs-icon-32.png?v=1758975222">
  <link rel="icon" type="image/png" sizes="16x16" href="/jobs-icon-16.png?v=1758975222">
  <link rel="manifest" href="/site.webmanifest?v=1758975222">
  <meta name="theme-color" content="#0b7ef2">
</head>
<body>
  <div class="errbar" id="errbar"></div>

  <header>
    <h1><span style='font-weight:700;color:#b91c1c;background:#fee2e2;padding:2px 6px;border-radius:6px'>BUILD ID: NO-EP-ABSOLUTE-1758975222</span> — HVAC Digital Binder</h1>
    <div class="toolbar">
      <button class="primary" id="add-contractor">+ Contractor</button>
      <button class="ghost" id="add-job">+ Job</button>
      <button class="ghost" id="to-settings">Settings</button>
      <button class="ghost" id="open-archives-top">Archives</button>
      <button class="ghost" id="to-main" style="display:none;">Back to Jobs</button>
      <button class="ghost" id="refresh-btn">Home</button>
      <div class="searchbar" style="margin-left:8px;">
        <input id="header-search" type="text" placeholder="Search job by #, name, or address…"/>
        <button id="header-search-btn">Open</button>
      </div>
      <div class="spacer"></div>
    </div>
    <div class="status" id="status">Loaded</div>
  
  <div class="header-right">
    <span id="userBadge" class="muted" style="font-size:12px;"></span>
    <button id="logoutBtn" class="ghost">Logout</button>
<div style="margin-top:6px;"><button class="ghost" onclick="window.open('https://hvacschedule.netlify.app/', '_blank', 'noopener');">Schedule</button></div>

  </div>

</header>

  <main>
    <aside>
      <div class="aside-head"><strong>Contractors</strong><span class="muted" id="contractor-count"></span></div>
      <div class="list" id="contractor-list"></div>
      <div class="muted" style="font-size:11px; margin-top:8px;">Tip: Double‑click a contractor to open</div>
    </aside>

    <section class="content view active" id="view-main">
      <div class="tabs-wrap"><div class="tabs" id="job-tabs"></div></div>
      <div id="job-panel">
        <div class="placeholder" id="placeholder-landing">
          <img id="company-logo" alt="Company logo" style="display:none;"/>
          <div id="company-logo-empty">Upload a company logo in Settings.</div>
          <div class="muted" style="font-size:12px; padding:8px;">Use the header search to jump to a job.</div>
        </div>

        <!-- Contractor home: logo only, controls BELOW -->
        <div class="logo-panel" id="contractor-logo-panel" style="display:none;">
          <img id="contractor-logo" alt="Contractor logo"/>
        </div>
        <div class="logo-controls" id="contractor-controls" style="display:none;">
          <label class="muted" style="font-size:12px;">Logo:</label>
          <input type="file" id="contractor-logo-file" accept="image/*"/>
          <button class="danger" id="delete-contractor">Delete Contractor</button>
        </div>

        <!-- Job fields -->
        <div id="job-fields" style="display:none; margin-top:12px;">
          <div class="top-row" id="job-actions" style="display:none;">
            <div class="row"><button class="ghost" id="edit-job">Edit Job</button><span class="spacer"></span><button class="ghost" id="archive-job">Archive</button>
<button class="danger" id="delete-job">Delete</button></div>
            </div>
          <div id="job-summary" class="summary" style="display:none; border:1px solid var(--line); border-radius:10px; padding:10px; margin-bottom:10px;"></div>
            <div class="fields" id="job-fields-inner">
            <div class="field small"><label>Job Name</label><input type="text" id="job-name" placeholder="e.g., Main St Remodel"/></div>
            <div class="field"><label>Address</label><input type="text" id="job-address" placeholder="e.g., 123 Main St, Springfield"/></div>
            <div class="field small"><label>PO #</label><input type="text" id="job-po" placeholder="e.g., PO-10452"/></div>
            <div class="field"><label>Stage</label><select id="job-stage"></select></div>
            <div class="field"><label>Crew</label><div id="crew-box" class="chips"></div></div>
          </div>
          <div style="margin-top:14px;">
            <div class="field"><label>Add Note</label><div class="note-toolbar" id="note-toolbar" style="display:flex;gap:6px;flex-wrap:wrap;margin:4px 0 6px;"><button id="note-bold" type="button"><strong>B</strong></button><button id="note-italic" type="button"><em>I</em></button><button id="note-underline" type="button"><u>U</u></button><button id="note-highlight" type="button">HL</button><button id="note-bullet" type="button">• List</button></div><div id="new-note-editor" class="note-editor" contenteditable="true" data-placeholder="What changed? Materials, inspections, dates..."></div><textarea id="new-note" style="display:none;"></textarea></textarea></div>
            <div class="row"><button id="add-note" class="primary">Add Note</button><div class="spacer"></div><div class="muted">Last updated: <span id="job-updated">—</span></div></div>
            <h3 style="margin:14px 0 6px;">Log</h3><div id="notes-list" class="list"></div>
          </div>
        </div>
      </div>
    </section>

    <section class="content view" id="view-settings">
      <h2>Settings</h2>
      <div id="job-summary" class="summary" style="display:none; border:1px solid var(--line); border-radius:10px; padding:10px; margin-bottom:10px;"></div>
            <div class="fields" id="job-fields-inner">
        <div class="field"><label>Company Logo (PNG/JPG)</label><input type="file" id="company-logo-file" accept="image/*"/><img id="company-logo-preview" alt="Preview" style="max-height:160px; display:none; margin-top:6px;"/></div>
        <div class="field"><label>Roster (one per line)</label><textarea id="roster-input"></textarea></div>
        <div class="field"><label>Stages (one per line)</label><textarea id="stages-input"></textarea></div>
      </div>
      <h3 style="margin:14px 0 6px;">Stage Colors</h3><div id="stage-colors" class="list"></div>
      <div class="row" style="margin-top:8px;"><button id="save-settings" class="primary">Save Settings</button><div class="spacer"></div><span class="muted">Pick up to 10 colors; tabs use ~25% transparency so labels stay readable.</span></div>
    </section>
  
    <!-- Archives View -->
    <section class="view" id="view-archives">
      <div class="row" style="margin-bottom:10px;">
        <button id="back-from-archives" class="ghost">Back</button>
        <div class="spacer"></div>
        <input type="search" id="archive-search" placeholder="Search archived jobs (name, PO, contractor)" style="min-width:260px;"/>
        <button id="archive-delete-selected" class="danger" disabled>Delete Selected</button>
      </div>
      <div class="row" style="margin-bottom:8px;">
        <label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="archive-select-all"/> Select all</label>
        <span class="muted" id="archive-count"></span>
      </div>
      <div id="archive-list" style="display:grid; gap:8px;"></div>
    </section>
    
</main>

  <div class="toast-wrap" id="toast-wrap"></div>
  <script defer src="app.js"></script>


<script>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const r = await fetch('/.netlify/functions/auth-check', { headers:{'cache-control':'no-cache'} });
      if (r.status === 401) {
        const next = encodeURIComponent(location.pathname + location.search);
        location.href = '/login.html?next=' + next;
      }
    } catch {}
  });
</script>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('logoutBtn');
    if (btn) {
      btn.addEventListener('click', async () => {
        try { await fetch('/.netlify/functions/auth-logout'); } catch {}
        const next = encodeURIComponent('/');
        location.href = '/login.html?next=' + next;
      });
    }
  });
</script>


<script>
document.addEventListener('DOMContentLoaded', async () => {
  // Home button: navigate to root
  const homeBtn = Array.from(document.querySelectorAll('button')).find(b => b.textContent.trim() === 'Home');
  if (homeBtn) {
    homeBtn.addEventListener('click', (e) => { e.preventDefault(); window.location.href = '/'; });
  }
  // Show logged-in user next to Logout
  const badge = document.getElementById('userBadge');
  try {
    const r = await fetch('/.netlify/functions/auth-check', { headers:{'cache-control':'no-cache'} });
    if (r.status === 200) {
      const j = await r.json().catch(()=>({}));
      if (badge && j && j.user) { badge.textContent = `(${j.user})`; }
    } else {
      if (badge) { badge.textContent = ''; }
    }
  } catch {}
});
</script>


<script>
document.addEventListener('DOMContentLoaded', async () => {
  // Home button (id="reload") -> text "Home" + navigate root
  const homeBtn = document.getElementById('reload');
  if (homeBtn) {
    homeBtn.textContent = 'Home';
    homeBtn.addEventListener('click', (e) => { e.preventDefault(); window.location.href = '/'; });
  }
  // Show logged-in user next to Logout
  const badge = document.getElementById('userBadge');
  try {
    const r = await fetch('/.netlify/functions/auth-check', { headers:{'cache-control':'no-cache'} });
    if (r.status === 200) {
      const j = await r.json().catch(()=>({}));
      if (badge && j && j.user) { badge.textContent = '(' + j.user + ')'; }
    } else if (badge) {
      badge.textContent = '';
    }
  } catch {}
  // Logout handler
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', async () => {
      try { await fetch('/.netlify/functions/auth-logout'); } catch {}
      const next = encodeURIComponent('/');
      location.href = '/login.html?next=' + next;
    });
  }
});
</script>

  <script src="checks.js?v=1758975222"></script>
  
</body>
</html>
