<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HVAC Digital Binder</title>
  <style>
    :root {
      --bg: #fff;
      --ink: #111;
      --muted: #6b7280;
      --line: #e5e7eb;
      --accent: #2563eb;
      --accent-ink: #fff;
      --pad: 12px;
      --tab-ink: #111;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: var(--ink); background: var(--bg); }
    header { padding: 10px var(--pad); border-bottom: 1px solid var(--line); position: sticky; top: 0; background: var(--bg); z-index: 10; }
    h1 { margin: 0 0 6px; text-align: center; font-size: 20px; font-weight: 700; }
    .toolbar { display:flex; justify-content:center; gap:8px; flex-wrap:wrap; align-items:center; }
    button, select, input[type="text"], textarea, input[type="file"], input[type="color"] {
      font: inherit;
      padding: 6px 10px;
      border: 1px solid var(--line);
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
    }
    input[type="text"], textarea, select, input[type="color"] { cursor:text; }
    input[type="file"] { padding: 6px; }
    button.primary { background: var(--accent); color: var(--accent-ink); border-color: var(--accent); cursor:pointer; }
    button.danger { background: #ef4444; color: #fff; border-color: #ef4444; cursor:pointer; }
    button.ghost { background: transparent; border-color: var(--line); cursor:pointer; }
    .status { text-align:center; font-size:12px; color: var(--muted); margin-top: 6px; }
    main { display: grid; grid-template-columns: 260px 1fr; min-height: calc(100vh - 100px); }
    aside { border-right: 1px solid var(--line); padding: var(--pad); }
    .aside-head { display:flex; justify-content:space-between; align-items:center; margin-bottom: 8px; }
    .list { display:flex; flex-direction:column; gap:6px; }
    .contractor { display:flex; flex-direction:column; gap:6px; padding:6px 8px; border:1px solid var(--line); border-radius: 8px; }
    .contractor.active { outline: 2px solid var(--accent); }
    .contractor .row { display:flex; gap:6px; align-items:center; }
    .contractor input[type="text"] { width: 100%; border:none; outline:none; }
    .logo-field { display:none; }
    .contractor.active .logo-field { display:flex; flex-direction:column; gap:4px; }
    .contractor .logo-preview { max-height: 60px; max-width: 100%; object-fit: contain; }
    section.content { padding: var(--pad); }
    .top-row { display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between; margin-bottom: 10px; }
    /* Notebook Tabs */
    .tabs-wrap { width:100%; border-bottom: 2px solid var(--line); padding-bottom: 4px; min-height: 42px; }
    .tabs { display:flex; gap:4px; flex-wrap:wrap; align-items:flex-end; }
    .tab {
      position: relative;
      padding: 8px 12px;
      border:1px solid var(--line);
      border-bottom: none;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      background: #f9fafb;
      color: var(--tab-ink);
      cursor: pointer;
      transform: translateY(2px);
      box-shadow: 0 1px 0 rgba(0,0,0,0.02);
    }
    .tab.active { background: #fff; transform: translateY(0); z-index: 2; }
    .tab .label { font-weight: 600; }
    .dot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; vertical-align:middle; }
    .fields { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .field { display:flex; flex-direction:column; gap:6px; }
    label { font-size: 12px; color: var(--muted); }
    textarea { min-height: 120px; resize: vertical; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .spacer { flex:1; }
    .archive-toggle { display:flex; align-items:center; gap:6px; }
    .muted { color: var(--muted); }
    .chips { display:flex; gap:6px; flex-wrap:wrap; }
    .chip { padding: 4px 8px; border:1px solid var(--line); border-radius:999px; font-size:12px; }
    .view { display:none; }
    .view.active { display:block; }
    .placeholder {
      display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:center;
      height: 50vh; color: var(--muted); border: 2px dashed var(--line); border-radius: 12px;
      background: #fafafa; padding:16px;
    }
    .placeholder img { max-width: 420px; opacity: .85; }
    .searchbar { display:flex; gap:8px; align-items:center; }
    .searchbar input { flex:1; min-width: 220px; }
    .logo-panel { display:flex; align-items:center; justify-content:center; height: 220px; border: 2px dashed var(--line); border-radius: 12px; background:#fafafa; margin-top:12px; }
    .logo-panel img { max-height: 200px; max-width: 90%; object-fit: contain; }
    /* Notes */
    .note-item { padding:10px; border:1px solid var(--line); border-radius:8px; background:#fff; }
    .note-date { font-size:12px; color:var(--muted); margin-bottom:4px; }
    /* Toasts */
    .toast-wrap { position: fixed; bottom: 18px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; flex-direction: column; z-index: 9999; pointer-events: none; }
    .toast { pointer-events: auto; padding: 10px 14px; border: 1px solid var(--line); border-radius: 10px; background: #fff; box-shadow: 0 6px 24px rgba(0,0,0,0.12); font-size: 14px; min-width: 200px; text-align: center; }
    /* Error banner */
    .errbar { position: fixed; top: 0; left: 0; right: 0; background: #fee2e2; color: #991b1b; padding: 8px 12px; font-size: 13px; border-bottom: 1px solid #fecaca; z-index: 10000; display: none; }
    @media (max-width: 900px) { main { grid-template-columns: 1fr; } aside { border-right: none; border-bottom: 1px solid var(--line); } .fields { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="errbar" id="errbar"></div>

  <header>
    <h1>HVAC Digital Binder</h1>
    <div class="toolbar">
      <button class="primary" id="add-contractor">+ Contractor</button>
      <button class="ghost" id="add-job">+ Job</button>
      <button class="ghost" id="to-settings">Settings</button>
      <button class="ghost" id="to-main" style="display:none;">Back to Jobs</button>
      <button class="ghost" id="refresh-btn">Reload</button>

      <!-- Header search -->
      <div class="searchbar" style="margin-left:8px;">
        <input id="header-search" type="text" placeholder="Search job by #, name, or address…"/>
        <button id="header-search-btn">Open</button>
      </div>

      <div class="spacer"></div>
    </div>
    <div class="status" id="status">Loaded</div>
  </header>

  <main>
    <aside>
      <div class="aside-head">
        <strong>Contractors</strong>
        <span class="muted" id="contractor-count"></span>
      </div>
      <div class="list" id="contractor-list"></div>
    </aside>

    <!-- MAIN VIEW -->
    <section class="content view active" id="view-main">
      <div class="tabs-wrap">
        <div class="tabs" id="job-tabs"></div>
      </div>

      <div id="job-panel">
        <!-- Landing: company logo only + optional search note -->
        <div class="placeholder" id="placeholder-landing">
          <img id="company-logo" alt="Company logo" style="display:none;"/>
          <div id="company-logo-empty">Upload a company logo in Settings.</div>
          <div class="muted" style="font-size:12px;">Tip: use the search bar in the header to jump to any job.</div>
        </div>

        <!-- Contractor no job: show contractor logo -->
        <div class="logo-panel" id="contractor-logo-panel" style="display:none;">
          <img id="contractor-logo" alt="Contractor logo"/>
        </div>

        <!-- Job fields -->
        <div id="job-fields" style="display:none; margin-top:12px;">
          <div class="top-row" id="job-actions" style="display:none;">
            <div class="row">
              <div class="archive-toggle">
                <input type="checkbox" id="show-archived"/>
                <label for="show-archived">Show archived</label>
              </div>
              <button class="ghost" id="archive-job">Archive</button>
              <button class="danger" id="delete-job">Delete</button>
            </div>
          </div>

          <div class="fields">
            <div class="field">
              <label>Job Name</label>
              <input type="text" id="job-name" placeholder="e.g., 123 Main St Buildout" />
            </div>
            <div class="field">
              <label>Stage</label>
              <select id="job-stage"></select>
            </div>
            <div class="field">
              <label>Crew</label>
              <div id="crew-box" class="chips"></div>
            </div>
          </div>

          <!-- Notes (dated entries) -->
          <div style="margin-top:14px;">
            <div class="field">
              <label>Add Note</label>
              <textarea id="new-note" placeholder="What changed? Materials, inspections, dates..."></textarea>
            </div>
            <div class="row">
              <button id="add-note" class="primary">Add Note</button>
              <div class="spacer"></div>
              <div class="muted">Last updated: <span id="job-updated">—</span></div>
            </div>

            <h3 style="margin:14px 0 6px;">Log</h3>
            <div id="notes-list" class="list"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- SETTINGS VIEW -->
    <section class="content view" id="view-settings">
      <h2 style="margin:0 0 10px;">Settings</h2>
      <div class="fields">
        <div class="field">
          <label>Company Logo (PNG/JPG)</label>
          <input type="file" id="company-logo-file" accept="image/*"/>
          <img id="company-logo-preview" alt="Preview" style="max-height:120px; display:none; margin-top:6px;"/>
        </div>
        <div class="field">
          <label>Roster (one per line)</label>
          <textarea id="roster-input" placeholder="e.g., Alice
Bob
Chris"></textarea>
        </div>
        <div class="field">
          <label>Stages (one per line)</label>
          <textarea id="stages-input" placeholder="e.g., Bid
Rough-in
Trim
Complete"></textarea>
        </div>
      </div>

      <h3 style="margin:14px 0 6px;">Stage Colors</h3>
      <div id="stage-colors" class="list"></div>

      <div class="row" style="margin-top:8px;">
        <button id="save-settings" class="primary">Save Settings</button>
        <div class="spacer"></div>
        <span class="muted">Pick up to 10 colors; tabs use ~25% transparency so labels stay readable.</span>
      </div>
    </section>
  </main>

  <div class="toast-wrap" id="toast-wrap" aria-live="polite" aria-atomic="true"></div>

  <script defer src="app.js"></script>
</body>
</html>
